<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Daily DevOps</title>

  <!-- העיצוב המקורי שלך -->
  <link rel="stylesheet" href="/static/style.css">
  <!-- תוספות (חיצים + LTR) -->
  <link rel="stylesheet" href="/static/addons.css">
  <!-- אייקון אתר -->
  <link rel="icon" href="/static/icons/favicon.svg" type="image/svg+xml">
</head>
<body>
  <header class="container">
    <div class="brand">
      <div class="logo">⚙️</div>
      <div>
        <h1>Daily DevOps</h1>
        <p class="subtitle">משפט היום · טיפ היום · סרטונים · כלים · הדרכות</p>
      </div>
    </div>
  </header>

  <!-- חיפוש -->
  <section class="search container">
    <div class="search-box ltr">
      <input id="q" type="text" placeholder="חפש בעולם ה-DevOps (כלי, וידאו, מדריך)…">
      <button id="btn">חפש</button>
    </div>
    <div id="results" class="results ltr"></div>
  </section>

  <main class="container grid">
    <!-- משפט היום (עם חיצים) -->
    <section class="card accent card-nav" id="quote-card">
      <button class="nav-btn prev" aria-label="הקודם" data-target="quote">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>

      <div>
        <h2 class="align-start">משפט היום</h2>
        <p id="quote-text" class="quote align-start">“{{ quote }}”</p>
        <small id="quote-author" class="align-start muted"></small>
      </div>

      <button class="nav-btn next" aria-label="הבא" data-target="quote">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>
    </section>

    <!-- טיפ היום (עם חיצים) -->
    <section class="card card-nav" id="tip-card">
      <button class="nav-btn prev" aria-label="הקודם" data-target="tip">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>

      <div>
        <h2 class="align-start">טיפ DevOps של היום</h2>
        <h3 id="tip-title" class="tip-title align-start">{{ tip.title }}</h3>
        <p id="tip-body" class="align-start">{{ tip.body }}</p>
        <p class="source align-start">
          מקור: <a id="tip-link" href="{{ tip.url }}" target="_blank" rel="noopener">{{ tip.source }}</a>
        </p>
      </div>

      <button class="nav-btn next" aria-label="הבא" data-target="tip">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>
    </section>

    <!-- סרטונים (קרוסלה) -->
    <section class="card card-nav" id="videos-card">
      <button class="nav-btn prev" aria-label="הקודם" data-target="video">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>

      <div style="width:100%;">
        <h2>סרטוני DevOps</h2>
        <div class="video">
          <div class="video-title" id="video-title"></div>
          <div class="video-frame">
            <iframe id="video-iframe" src="" title="" frameborder="0" allowfullscreen></iframe>
          </div>
        </div>
      </div>

      <button class="nav-btn next" aria-label="הבא" data-target="video">
        <svg class="chev" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"/>
        </svg>
      </button>
    </section>

    <!-- כלים (LTR) -->
    <section class="card ltr">
      <h2 class="align-start">Recommended tools</h2>
      <div class="tools">
        {% for t in tools %}
        <a class="tool" href="{{ t.url }}" target="_blank" rel="noopener">
          <div class="tool-name">{{ t.name }}</div>
          <div class="tool-desc">{{ t.desc }}</div>
        </a>
        {% endfor %}
      </div>
    </section>

    <!-- הדרכות (LTR) -->
    <section class="card ltr">
      <h2 class="align-start">Learning resources</h2>
      <ul class="learning">
        {% for l in learning %}
          <li><a href="{{ l.url }}" target="_blank" rel="noopener">{{ l.title }}</a> — {{ l.desc }}</li>
        {% endfor %}
      </ul>
    </section>
  </main>

  <footer class="container footer ltr">
    <span>Deployed on Kubernetes · GitHub Actions CI/CD</span>
    <a href="https://github.com/{{ repo }}" target="_blank" rel="noopener">View on GitHub</a>
  </footer>

  <!-- מעביר את מערך הסרטונים מהשרת (content.py) -->
  <script id="videos-data" type="application/json">
    {{ videos|tojson|safe }}
  </script>

  <script>
    /* ===== חיפוש (מקומי + רשת) ===== */
    async function runSearch() {
      const q = document.getElementById('q').value.trim();
      const box = document.getElementById('results');
      if (!q) { box.innerHTML = ''; return; }
      box.innerHTML = 'מחפש...';
      try {
        const r = await fetch('/search?q=' + encodeURIComponent(q) + '&scope=all');
        const data = await r.json();
        if (!data.results || !data.results.length) {
          box.innerHTML = '<p>לא נמצאו תוצאות.</p>'; return;
        }
        box.innerHTML = data.results.map(item => `
          <div class="card">
            <small class="tag">${item.type || 'link'}</small>
            <a class="result-link" href="${item.url}" target="_blank" rel="noopener">
              <h4>${item.title || 'ללא כותרת'}</h4>
            </a>
            <p>${item.desc || ''}</p>
          </div>`).join('');
      } catch { box.innerHTML = '<p>שגיאה בחיפוש.</p>'; }
    }
    document.getElementById('btn').addEventListener('click', runSearch);
    document.getElementById('q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') runSearch(); });

    /* ===== קרוסלות (quotes/tips/videos) ===== */
    let QUOTES = [], TIPS = [], VIDEOS = [];
    const st = { qi: 0, ti: 0, vi: 0 };
    const $  = (id) => document.getElementById(id);

    // סרטונים שמוזרקים מהשרת
    (function loadVideosFromScript(){
      const el = document.getElementById('videos-data');
      try { VIDEOS = JSON.parse(el.textContent || '[]'); } catch {}
      renderVideo();
    })();

    function renderVideo(){
      if (!VIDEOS.length) return;
      const v = VIDEOS[st.vi % VIDEOS.length];
      const t = $('video-title'), f = $('video-iframe');
      if (t) t.textContent = v.title || '';
      if (f) { f.src = v.embed || v.url || ''; f.title = v.title || 'video'; }
    }

    async function loadQuotesTips(){
      try{
        const [qRes, tRes] = await Promise.all([
          fetch('/api/quotes', {cache:'no-store'}),
          fetch('/api/tips',   {cache:'no-store'}),
        ]);
        QUOTES = await qRes.json();
        TIPS   = await tRes.json();
        const day = Math.floor(Date.now()/86400000);
        if (QUOTES.length) st.qi = day % QUOTES.length;
        if (TIPS.length)   st.ti = day % TIPS.length;
        renderQuote(); renderTip();
      }catch(e){ console.error(e); }
    }
    function renderQuote(){
      if (!QUOTES.length) return;
      const q = QUOTES[st.qi % QUOTES.length];
      const qt = $('quote-text'), qa = $('quote-author');
      if (qt) qt.textContent = `“${q.text}”`;
      if (qa) qa.textContent = q.author ? `— ${q.author}` : '';
    }
    function renderTip(){
      if (!TIPS.length) return;
      const t = TIPS[st.ti % TIPS.length];
      const tt=$('tip-title'), tb=$('tip-body'), tl=$('tip-link');
      if (tt) tt.textContent = t.title || '';
      if (tb) tb.textContent = t.body  || '';
      if (tl) { tl.textContent = t.source || 'source'; tl.href = t.url || '#'; }
    }
    function step(kind, dir){
      if (kind==='quote' && QUOTES.length){ st.qi=(st.qi+dir+QUOTES.length)%QUOTES.length; renderQuote(); }
      if (kind==='tip'   && TIPS.length){   st.ti=(st.ti+dir+TIPS.length)%TIPS.length;   renderTip(); }
      if (kind==='video' && VIDEOS.length){ st.vi=(st.vi+dir+VIDEOS.length)%VIDEOS.length; renderVideo(); }
    }
    document.querySelectorAll('.nav-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const kind = btn.dataset.target;
        const dir  = btn.classList.contains('next') ? +1 : -1;
        step(kind, dir);
      });
    });

    loadQuotesTips();
  </script>
</body>
</html>
